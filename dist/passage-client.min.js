var Passage=function(){"use strict";function t(t,e){if(void 0!==t&&void 0!==this._events[t])for(var n=0;n<this._events.length;n++)this._events[n](e)}function e(){this._tries=0,t.call(this,"rpc.open")}function n(){this.options.reconnect&&this._tries<=this.options.reconnectTries&&(this._tries++,setTimeout(this.connect,this.options.reconnectTimeout)),t.call(this,"rpc.close")}function i(e){t.call(this,"rpc.error",e)}function o(t){if("2.0"!==t.jsonrpc)throw new Error;if(void 0!==t.method)return t;if(void 0===t.id)throw new Error;if(void 0!==t.error)return t;if(void 0!==t.result)return t;throw new Error}function s(t){var e=JSON.parse(t);return Array.isArray(e)?e.map(o):[o(e)]}function r(t,e,n){if(void 0!==t&&void 0!==this._callbacks[t])if(e){var i=new Error(e.message);i.code=e.code,i.data=e.data,this._callbacks[t](i)}else this._callbacks[t](void 0,n);delete this._callbacks[t]}function c(e){var n;try{n=s(e.data)}catch(t){return console.log("Warning: Non JSON-RPC message received."),void console.log(e.data)}for(var i=0;i<n.length;i++){var o=n[i];t.call(this,"rpc.message",o),t.call(this,o.method,o.params),r.call(this,o.id,o.error,o.result)}}function h(t){if(void 0!==this._callbacks[t]){var e=new Error("Timeout");e.code=408,this._callbacks[t](e),delete this._callbacks[t]}}function a(t,e){return"number"==typeof t?t:e}function d(t,e){e=e||{},this.uri=t,this.options={requestTimeout:a(e.requestTimeout,6e3),reconnect:!!e.reconnect,reconnectTimeout:a(e.reconnectTimeout,2e3),reconnectTries:a(e.reconnectTries,60)},this._nextId=1,this._tries=0,this._callbacks={},this._events={},this.connect()}return d.prototype.close=function(){void 0!==this.connection&&this.connection.close()},d.prototype.connect=function(){this.close(),this.connection=new WebSocket(this.uri),this.connection.addEventListener("open",e.bind(this)),this.connection.addEventListener("close",n.bind(this)),this.connection.addEventListener("error",i.bind(this)),this.connection.addEventListener("message",c.bind(this))},d.prototype.send=function(t,e,n,i){if(void 0===this.connection)return void("function"==typeof n&&n(new Error("No connection")));var o,s="function"==typeof n?this._nextId++:void 0;try{o=JSON.stringify({id:s,method:t,params:e,jsonrpc:"2.0"})}catch(t){return void("function"==typeof n&&n(t))}if("function"==typeof n){this._callbacks[s]=n;var r=a(i,this.options.requestTimeout);setTimeout(function(){h.call(this,s)},r)}this.connection.send(o)},d.prototype.addEventListener=function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},d.prototype.removeEventListener=function(t,e){if(void 0!==this._events[t]){var n=this._events[t].indexOf(e);n<0||(this._events[t].splice(n,1),this._events[t].length<1&&delete this._events[t])}},d}();
//# sourceMappingURL=passage-client.min.js.map