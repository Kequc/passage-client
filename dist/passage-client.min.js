var Passage=function(){"use strict";return function(t){function e(t,e){if(void 0!==t&&void 0!==this._events[t])for(var i=0;i<this._events[t].length;i++)this._events[t][i](e)}function i(){this._tries=0,e.call(this,"rpc.open")}function n(){if(this.options.reconnect&&!this.connection.killed&&this._tries<=this.options.reconnectTries){this._tries++;var t=this;setTimeout(function(){t.connect()},this.options.reconnectTimeout)}e.call(this,"rpc.close")}function o(t){e.call(this,"rpc.error",t)}function s(t,e,i){if(void 0!==t&&void 0!==this._callbacks[t])if(e){var n=new Error(e.message);n.code=e.code,n.data=e.data,this._callbacks[t](n)}else this._callbacks[t](void 0,i);delete this._callbacks[t]}function c(t){return"object"!=typeof t?l.INVALID:"2.0"!==t.jsonrpc?l.INVALID:void 0!==t.method?l.NOTIFICATION:void 0===t.id?l.INVALID:void 0!==t.error&&void 0!==t.result?l.INVALID:void 0!==t.error||void 0!==t.result?l.RESPONSE:l.INVALID}function r(t){e.call(this,"rpc.message",t.data);var i;try{i=JSON.parse(t.data),Array.isArray(i)||(i=[i])}catch(t){return}for(var n=0;n<i.length;n++){var o=i[n];switch(c(o)){case l.NOTIFICATION:e.call(this,o.method,o.params);break;case l.RESPONSE:s.call(this,o.id,o.error,o.result)}}}function a(t){if(void 0!==this._callbacks[t]){var e=new Error("Timeout");e.code=408,this._callbacks[t](e),delete this._callbacks[t]}}function h(t,e){return"number"==typeof t?t:e}function d(t,e){e=e||{},this.uri=t,this.options={requestTimeout:h(e.requestTimeout,6e3),reconnect:!!e.reconnect,reconnectTimeout:h(e.reconnectTimeout,2e3),reconnectTries:h(e.reconnectTries,60)},this._nextId=1,this._tries=0,this._callbacks={},this._events={},this.connect()}var l={INVALID:"invalid",RESPONSE:"response",NOTIFICATION:"notification"};return d.prototype.close=function(){void 0!==this.connection&&(this.connection.killed=!0,this.connection.close())},d.prototype.connect=function(){this.close(),this.connection=new t(this.uri),this.connection.addEventListener("open",i.bind(this)),this.connection.addEventListener("close",n.bind(this)),this.connection.addEventListener("error",o.bind(this)),this.connection.addEventListener("message",r.bind(this))},d.prototype.send=function(t,e,i,n){if(void 0===this.connection)return void("function"==typeof i&&i(new Error("No connection")));var o,s="function"==typeof i?this._nextId++:void 0;try{o=JSON.stringify({id:s,method:t,params:e,jsonrpc:"2.0"})}catch(t){return void("function"==typeof i&&i(t))}if("function"==typeof i){this._callbacks[s]=i;var c=h(n,this.options.requestTimeout),r=this;setTimeout(function(){a.call(r,s)},c)}this.connection.send(o)},d.prototype.addEventListener=function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},d.prototype.removeEventListener=function(t,e){if(void 0!==this._events[t]){var i=this._events[t].indexOf(e);i<0||(this._events[t].splice(i,1),this._events[t].length<1&&delete this._events[t])}},d}(WebSocket)}();
//# sourceMappingURL=passage-client.min.js.map