var Passage=function(){"use strict";function t(t,e){if(void 0!==t&&void 0!==this._events[t])for(var i=0;i<this._events.length;i++)this._events[i](e)}function e(){this._tries=0,t.call(this,"rpc.open")}function i(){this.options.reconnect&&this._tries<=this.options.reconnectTries&&(this._tries++,setTimeout(this.connect,this.options.reconnectTimeout)),t.call(this,"rpc.close")}function n(e){t.call(this,"rpc.error",e)}function o(t,e,i){if(void 0!==t&&void 0!==this._callbacks[t])if(e){var n=new Error(e.message);n.code=e.code,n.data=e.data,this._callbacks[t](n)}else this._callbacks[t](void 0,i);delete this._callbacks[t]}function s(t){return"object"!=typeof t?d.INVALID:"2.0"!==t.jsonrpc?d.INVALID:void 0!==t.method?d.NOTIFICATION:void 0===t.id?d.INVALID:void 0!==t.error?d.RESPONSE:void 0!==t.result?d.RESPONSE:d.INVALID}function c(e){t.call(this,"rpc.message",e.data);var i;try{i=JSON.parse(e.data),Array.isArray(i)||(i=[i])}catch(t){return}for(var n=0;n<i.length;n++){var c=i[n];switch(s(c)){case d.NOTIFICATION:t.call(this,c.method,c.params);break;case d.RESPONSE:o.call(this,c.id,c.error,c.result)}}}function r(t){if(void 0!==this._callbacks[t]){var e=new Error("Timeout");e.code=408,this._callbacks[t](e),delete this._callbacks[t]}}function a(t,e){return"number"==typeof t?t:e}function h(t,e){e=e||{},this.uri=t,this.options={requestTimeout:a(e.requestTimeout,6e3),reconnect:!!e.reconnect,reconnectTimeout:a(e.reconnectTimeout,2e3),reconnectTries:a(e.reconnectTries,60)},this._nextId=1,this._tries=0,this._callbacks={},this._events={},this.connect()}var d={INVALID:"invalid",RESPONSE:"response",NOTIFICATION:"notification"};return h.prototype.close=function(){void 0!==this.connection&&this.connection.close()},h.prototype.connect=function(){this.close(),this.connection=new WebSocket(this.uri),this.connection.addEventListener("open",e.bind(this)),this.connection.addEventListener("close",i.bind(this)),this.connection.addEventListener("error",n.bind(this)),this.connection.addEventListener("message",c.bind(this))},h.prototype.send=function(t,e,i,n){if(void 0===this.connection)return void("function"==typeof i&&i(new Error("No connection")));var o,s="function"==typeof i?this._nextId++:void 0;try{o=JSON.stringify({id:s,method:t,params:e,jsonrpc:"2.0"})}catch(t){return void("function"==typeof i&&i(t))}if("function"==typeof i){this._callbacks[s]=i;var c=a(n,this.options.requestTimeout);setTimeout(function(){r.call(this,s)},c)}this.connection.send(o)},h.prototype.addEventListener=function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},h.prototype.removeEventListener=function(t,e){if(void 0!==this._events[t]){var i=this._events[t].indexOf(e);i<0||(this._events[t].splice(i,1),this._events[t].length<1&&delete this._events[t])}},h}();
//# sourceMappingURL=passage-client.min.js.map