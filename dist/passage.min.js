var Passage=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(void 0!==t&&void 0!==this._events[t]){var n=!0,i=!1,o=void 0;try{for(var r,s=this._events[t][Symbol.iterator]();!(n=(r=s.next()).done);n=!0){(0,r.value)(e)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}}function n(){this._tries=0,e.call(this,"rpc.open")}function i(){this.options.reconnect&&this._tries<=this.options.reconnectTries&&(this._tries++,setTimeout(this.connect,this.options.reconnectTimeout)),e.call(this,"rpc.close")}function o(t){e.call(this,"rpc.error",t)}function r(t){if("2.0"!==t.jsonrpc)throw new Error;if(void 0!==t.method)return t;if(void 0===t.id)throw new Error;if(void 0!==t.error)return t;if(void 0!==t.result)return t;throw new Error}function s(t){var e=JSON.parse(t);return Array.isArray(e)?e.map(r):[r(e)]}function c(t,e,n){if(void 0!==t&&void 0!==this._callbacks[t])if(e){var i=new Error(e.message);i.code=e.code,i.data=e.data,this._callbacks[t](i)}else this._callbacks[t](void 0,n);delete this._callbacks[t]}function a(t){var n=void 0;try{n=s(t.data)}catch(e){return console.log("Warning: Non JSON-RPC message received."),void console.log(t.data)}var i=!0,o=!1,r=void 0;try{for(var a,l=n[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var h=a.value;e.call(this,"rpc.message",h),e.call(this,h.method,h.params),c.call(this,h.id,h.error,h.result)}}catch(t){o=!0,r=t}finally{try{!i&&l.return&&l.return()}finally{if(o)throw r}}}function l(t){if(void 0!==this._callbacks[t]){var e=new Error("Timeout");e.code=408,this._callbacks[t](e),delete this._callbacks[t]}}var h=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function(t,e){return"number"==typeof t?t:e};return function(){function e(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,e),this.uri=n,this.options={requestTimeout:u(i.requestTimeout,6e3),reconnect:!!i.reconnect,reconnectTimeout:u(i.reconnectTimeout,2e3),reconnectTries:u(i.reconnectTries,60)},this._nextId=1,this._tries=0,this._callbacks={},this._events={},this.connect()}return h(e,[{key:"close",value:function(){void 0!==this.connection&&this.connection.close()}},{key:"connect",value:function(){this.close(),this.connection=new WebSocket(this.uri),this.connection.addEventListener("open",n.bind(this)),this.connection.addEventListener("close",i.bind(this)),this.connection.addEventListener("error",o.bind(this)),this.connection.addEventListener("message",a.bind(this))}},{key:"send",value:function(t,e,n,i){var o=this;if(void 0===this.connection)return void("function"==typeof n&&n(new Error("No connection")));var r=this._nextId++,s=void 0;try{s=JSON.stringify({id:r,method:t,params:e,jsonrpc:"2.0"})}catch(t){return void("function"==typeof n&&n(t))}if("function"==typeof n){this._callbacks[r]=n;var c=u(i,this.options.requestTimeout);setTimeout(function(){l.call(o,r)},c)}this.connection.send(s)}},{key:"addEventListener",value:function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)}},{key:"removeEventListener",value:function(t,e){if(void 0!==this._events[t]){var n=this._events[t].indexOf(e);n<0||(this._events[t].splice(n,1),this._events[t].length<1&&delete this._events[t])}}}]),e}()}();
//# sourceMappingURL=passage.min.js.map